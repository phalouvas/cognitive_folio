{% raw %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Prompt Variable Reference - Cognitive Folio</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
            background: #f8f9fa;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
            margin-bottom: 30px;
        }
        h2 {
            color: #34495e;
            margin-top: 40px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }
        h3 {
            color: #16a085;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #e74c3c;
        }
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
        }
        pre code {
            background: none;
            color: #ecf0f1;
            padding: 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        table th {
            background: #3498db;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        table td {
            padding: 10px 12px;
            border-bottom: 1px solid #ecf0f1;
        }
        table tr:hover {
            background: #f8f9fa;
        }
        .tip-box {
            background: #e8f4f8;
            border-left: 4px solid #3498db;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .warning-box {
            background: #fff9e6;
            border-left: 4px solid #f39c12;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .example-box {
            background: #f0f9ff;
            border: 1px solid #3498db;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        ul {
            padding-left: 25px;
        }
        li {
            margin-bottom: 8px;
        }
        hr {
            border: none;
            border-top: 1px solid #ecf0f1;
            margin: 30px 0;
        }
        .footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #ecf0f1;
            color: #7f8c8d;
            font-size: 0.9em;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AI Prompt Variable Reference</h1>
        <p>Unified variable syntax for Cognitive Folio AI prompts across Security, Portfolio, Holding, and Chat contexts.</p>

        <hr>

        <h2>1. Security Fields</h2>
        <p>Use double curly braces to inject fields from a <code>CF Security</code> document.</p>
        
        <div class="example-box">
            <strong>Example:</strong><br>
            <code>{{security_name}}</code>, <code>{{symbol}}</code>, <code>{{current_price}}</code>, <code>{{sector}}</code>
        </div>

        <div class="tip-box">
            <strong>Rules:</strong>
            <ul>
                <li>Dot path for JSON fields: <code>{{ticker_info.marketCap}}</code></li>
                <li>Wildcard over arrays/dicts: <code>{{news.ARRAY.content.title}}</code> collects all titles</li>
                <li>Index access: <code>{{news.0.content.title}}</code></li>
            </ul>
        </div>

        <hr>

        <h2>2. Holding Fields</h2>
        <p>Use double square brackets for <code>CF Portfolio Holding</code> fields when holding context exists.</p>
        
        <div class="example-box">
            <strong>Example:</strong><br>
            <code>[[quantity]]</code>, <code>[[average_purchase_price]]</code>, <code>[[current_value]]</code>, <code>[[allocation_percentage]]</code>
        </div>

        <hr>

        <h2>3. Portfolio Fields</h2>
        <p>Use double parentheses for <code>CF Portfolio</code> fields inside portfolio prompts.</p>
        
        <div class="example-box">
            <strong>Example:</strong><br>
            <code>((portfolio_name))</code>, <code>((risk_profile))</code>, <code>((current_value))</code>, <code>((returns_total))</code>
        </div>

        <h3>Performance Metrics:</h3>
        <table>
            <thead>
                <tr>
                    <th>Variable</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>((cost))</code></td>
                    <td>Total cost basis</td>
                </tr>
                <tr>
                    <td><code>((current_value))</code></td>
                    <td>Current portfolio value</td>
                </tr>
                <tr>
                    <td><code>((returns_price))</code></td>
                    <td>Price-based returns (amount)</td>
                </tr>
                <tr>
                    <td><code>((returns_percentage_price))</code></td>
                    <td>Price-based returns (%)</td>
                </tr>
                <tr>
                    <td><code>((returns_dividends))</code></td>
                    <td>Dividend income received</td>
                </tr>
                <tr>
                    <td><code>((returns_percentage_dividends))</code></td>
                    <td>Dividend returns (%)</td>
                </tr>
                <tr>
                    <td><code>((returns_total))</code></td>
                    <td>Total returns (price + dividends)</td>
                </tr>
                <tr>
                    <td><code>((returns_percentage_total))</code></td>
                    <td>Total returns (%)</td>
                </tr>
                <tr>
                    <td><code>((annualized_percentage_dividends))</code></td>
                    <td>Portfolio dividend yield (%)</td>
                </tr>
                <tr>
                    <td><code>((annualized_dividends))</code></td>
                    <td>Annualized dividend income estimate</td>
                </tr>
            </tbody>
        </table>

        <hr>

        <h2>3a. Pre-Computed Portfolio Analytics</h2>
        <p>These variables provide aggregated portfolio insights computed during performance calculations. They reduce AI computation load and improve reliability.</p>
        
        <h3>Concentration Risk:</h3>
        <div class="example-box">
            <strong>Variable:</strong> <code>((top_5_concentration))</code><br>
            <strong>Output:</strong> Sum of the 5 largest holdings by allocation percentage<br>
            <strong>Example:</strong> <code>45.2</code> (meaning 45.2% of portfolio in top 5 positions)
        </div>

        <div class="warning-box">
            <strong>Risk Threshold:</strong> Values >40% indicate high concentration risk and warrant diversification review.
        </div>

        <h3>Sector Allocation Breakdown:</h3>
        <div class="example-box">
            <strong>Variable:</strong> <code>((sector_allocations))</code><br>
            <strong>Output:</strong> Formatted markdown list of sectors sorted by percentage (descending)<br>
            <strong>Example Output:</strong>
            <pre><code>- **Technology:** 35.5%
- **Healthcare:** 22.3%
- **Financials:** 18.7%
- **Consumer Discretionary:** 12.1%
- **Industrials:** 8.9%
- **Unknown:** 2.5%</code></pre>
        </div>

        <h3>Regional Allocation:</h3>
        <div class="example-box">
            <strong>Variable:</strong> <code>((region_allocations))</code><br>
            <strong>Output:</strong> Formatted markdown list of regions sorted by percentage<br>
            <strong>Example Output:</strong>
            <pre><code>- **North America:** 62.4%
- **Europe:** 28.1%
- **Asia Pacific:** 7.3%
- **Unknown:** 2.2%</code></pre>
        </div>

        <h3>Country Breakdown:</h3>
        <div class="example-box">
            <strong>Variable:</strong> <code>((country_allocations))</code><br>
            <strong>Output:</strong> Formatted markdown list of countries sorted by percentage<br>
            <strong>Example Output:</strong>
            <pre><code>- **United States:** 58.9%
- **United Kingdom:** 15.2%
- **Germany:** 8.7%
- **France:** 4.2%
- **Japan:** 5.8%
- **Unknown:** 7.2%</code></pre>
        </div>

        <h3>Currency Exposure:</h3>
        <div class="example-box">
            <strong>Variable:</strong> <code>((currency_exposure))</code><br>
            <strong>Output:</strong> Formatted markdown list of currencies sorted by percentage<br>
            <strong>Example Output:</strong>
            <pre><code>- **USD:** 62.4%
- **EUR:** 28.1%
- **GBP:** 7.3%
- **JPY:** 2.2%</code></pre>
        </div>

        <div class="tip-box">
            <strong>FX Risk Assessment:</strong> Compare currency exposure to portfolio base currency <code>((currency))</code>. High mismatch (>20% in foreign currencies) creates FX risk.
        </div>

        <h3>Target vs. Actual Allocations:</h3>
        <div class="example-box">
            <strong>Variable:</strong> <code>((target_vs_actual_allocations))</code><br>
            <strong>Source:</strong> CF Asset Allocation records for the portfolio<br>
            <strong>Output:</strong> Formatted breakdown by allocation type with targets, actuals, and drift<br>
            <strong>Example Output:</strong>
            <pre><code>**Asset Class:**
- Stocks: Target 70%, Current 75.2%, Difference +5.2%
- Bonds: Target 25%, Current 19.8%, Difference -5.2%
- Cash: Target 5%, Current 5.0%, Difference +0.0%

**Sector:**
- Technology: Target 30%, Current 35.5%, Difference +5.5%
- Healthcare: Target 20%, Current 22.3%, Difference +2.3%
- Financials: Target 15%, Current 18.7%, Difference +3.7%

**Region:**
- North America: Target 60%, Current 62.4%, Difference +2.4%
- Europe: Target 30%, Current 28.1%, Difference -1.9%
- Asia Pacific: Target 10%, Current 7.3%, Difference -2.7%</code></pre>
        </div>

        <div class="warning-box">
            <strong>Rebalancing Trigger:</strong> Allocation drift >15% from target typically warrants rebalancing action.
        </div>

        <h3>Usage in Prompts:</h3>
        <div class="example-box">
            <p>Instead of asking the AI to calculate aggregations, inject pre-computed data:</p>
            <pre><code>## Portfolio Concentration
Top 5 Holdings: ((top_5_concentration))% of portfolio

## Sector Exposure
((sector_allocations))

## Geographic Distribution
**Regions:**
((region_allocations))

**Countries:**
((country_allocations))

## Currency Risk
Base Currency: ((currency))
Exposure Breakdown:
((currency_exposure))

## Target vs. Actual Allocations
((target_vs_actual_allocations))</code></pre>
            <p><small>This provides the AI with all key metrics for interpretation rather than calculation.</small></p>
        </div>

        <hr>

        <h2>4. Structured Financial Periods</h2>
        <p>Insert clean, formatted historical financial data using the periods syntax.</p>
        
        <h3>Pattern:</h3>
        <pre><code>{{periods:&lt;type&gt;:&lt;count&gt;[:format]}}</code></pre>
        
        <ul>
            <li><code>&lt;type&gt;</code>: <code>annual</code>, <code>quarterly</code>, <code>ttm</code></li>
            <li><code>&lt;count&gt;</code>: number of periods (e.g. 3, 4, 5)</li>
            <li><code>format</code> (optional): <code>markdown</code> (default), <code>text</code>, <code>json</code>, <code>table</code></li>
        </ul>

        <h3>Examples:</h3>
        <div class="example-box">
            <ul>
                <li><code>{{periods:annual:3}}</code> → last 3 annual periods (markdown summary)</li>
                <li><code>{{periods:quarterly:4:table}}</code> → last 4 quarters as a table</li>
                <li><code>{{periods:annual:5:text}}</code> → plain text periods</li>
                <li><code>{{periods:quarterly:8:json}}</code> → raw JSON (be mindful of token size)</li>
            </ul>
        </div>

        <div class="warning-box">
            <strong>Token Guidance:</strong>
            <ul>
                <li>Annual 3 (markdown): ~200–400 tokens</li>
                <li>Quarterly 4 (table): ~250–500 tokens</li>
                <li>Annual 5 JSON: can exceed 800 tokens</li>
            </ul>
            Keep within model limits; prefer smaller counts for exploratory analysis.
        </div>

        <hr>

        <h2>5. Comparison Syntax</h2>
        <p>Compare financial periods side-by-side with percentage changes.</p>

        <h3>Pattern:</h3>
        <pre><code>{{periods:compare:&lt;period1&gt;:&lt;period2&gt;}}</code></pre>

        <h3>Examples:</h3>
        <div class="example-box">
            <ul>
                <li><code>{{periods:compare:2024:2023}}</code> → Annual comparison</li>
                <li><code>{{periods:compare:2024Q3:2024Q2}}</code> → Quarterly comparison</li>
            </ul>
        </div>

        <div class="tip-box">
            <strong>Natural Language Support:</strong><br>
            You can also use natural language in chat messages:
            <ul>
                <li>"compare Q3 2024 vs Q2 2024"</li>
                <li>"compare 2024 to 2023"</li>
                <li>"compare Q3 vs previous quarter"</li>
            </ul>
            These will be automatically transformed to comparison syntax.
        </div>

        <hr>

        <h2>5a. Relative Period Comparisons</h2>
        <p>Use dynamic relative references that automatically resolve to actual periods based on available data.</p>

        <h3>Pattern:</h3>
        <pre><code>{{periods:compare:&lt;relative_spec1&gt;:&lt;relative_spec2&gt;}}</code></pre>

        <h3>Available Relative Specifications:</h3>
        
        <table>
            <thead>
                <tr>
                    <th>Relative Spec</th>
                    <th>Description</th>
                    <th>Example Resolution</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>latest_annual</code></td>
                    <td>Most recent annual period</td>
                    <td>2024</td>
                </tr>
                <tr>
                    <td><code>previous_annual</code></td>
                    <td>One year before latest</td>
                    <td>2023 (if latest is 2024)</td>
                </tr>
                <tr>
                    <td><code>annual_minus_2</code></td>
                    <td>Two years before latest</td>
                    <td>2022 (if latest is 2024)</td>
                </tr>
                <tr>
                    <td><code>annual_minus_3</code></td>
                    <td>Three years before latest</td>
                    <td>2021 (if latest is 2024)</td>
                </tr>
                <tr>
                    <td><code>annual_minus_4</code></td>
                    <td>Four years before latest</td>
                    <td>2020 (if latest is 2024)</td>
                </tr>
                <tr>
                    <td><code>latest_quarterly</code></td>
                    <td>Most recent quarterly period</td>
                    <td>2024Q3</td>
                </tr>
                <tr>
                    <td><code>previous_quarterly</code></td>
                    <td>Sequential previous quarter</td>
                    <td>2024Q2 (if latest is 2024Q3)</td>
                </tr>
                <tr>
                    <td><code>yoy_quarterly</code></td>
                    <td>Same quarter, previous year</td>
                    <td>2023Q3 (if latest is 2024Q3)</td>
                </tr>
            </tbody>
        </table>

        <h3>Examples:</h3>
        <div class="example-box">
            <ul>
                <li><code>{{periods:compare:latest_annual:previous_annual}}</code> → Compare most recent year to prior year</li>
                <li><code>{{periods:compare:latest_annual:annual_minus_2}}</code> → Compare current year to 2 years ago</li>
                <li><code>{{periods:compare:latest_quarterly:previous_quarterly}}</code> → Compare latest quarter to previous quarter (sequential momentum)</li>
                <li><code>{{periods:compare:latest_quarterly:yoy_quarterly}}</code> → Compare latest quarter to same quarter last year (removes seasonality)</li>
            </ul>
        </div>

        <div class="tip-box">
            <strong>Benefits of Relative Periods:</strong>
            <ul>
                <li>Prompts remain valid as new data arrives - no need to update hardcoded years</li>
                <li>Automatically handles quarter boundaries (e.g., Q1 2024 → Q4 2023)</li>
                <li>Works for all securities regardless of their reporting schedule</li>
                <li>Ideal for permanent prompt templates that analyze latest data</li>
            </ul>
        </div>

        <div class="warning-box">
            <strong>Error Handling:</strong><br>
            When insufficient historical data exists (e.g., newly listed company with only 1 annual period):
            <ul>
                <li>Returns: <code>[Insufficient historical data for previous annual]</code></li>
                <li>Prompt continues processing - does not fail completely</li>
                <li>AI can acknowledge data limitations in analysis</li>
            </ul>
        </div>

        <h3>Best Practice - Investment Analysis:</h3>
        <div class="example-box">
            <p>For comprehensive security evaluation, combine historical depth with multiple comparison angles:</p>
            <pre><code>## Historical Context
{{periods:annual:5:markdown}}
{{periods:quarterly:8:markdown}}

## Key Comparisons
Latest vs Prior Year: {{periods:compare:latest_annual:previous_annual}}
Latest vs 2 Years Ago: {{periods:compare:latest_annual:annual_minus_2}}
Sequential Momentum: {{periods:compare:latest_quarterly:previous_quarterly}}
YoY Growth (removes seasonality): {{periods:compare:latest_quarterly:yoy_quarterly}}</code></pre>
            <p><small>This provides 5 years of annual trends, 2 years of quarterly patterns, and 4 comparison perspectives for thorough analysis.</small></p>
        </div>

        <hr>

        <h2>6. JSON Path Extraction</h2>
        <p>When a field stores JSON (e.g. <code>news</code>, <code>ticker_info</code>):</p>
        
        <table>
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Syntax</th>
                    <th>Example</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Single path</td>
                    <td><code>{{jsonfield.key}}</code></td>
                    <td><code>{{ticker_info.marketCap}}</code></td>
                </tr>
                <tr>
                    <td>Array index</td>
                    <td><code>{{jsonfield.0.key}}</code></td>
                    <td><code>{{news.0.content.title}}</code></td>
                </tr>
                <tr>
                    <td>Wildcard aggregation</td>
                    <td><code>{{jsonfield.ARRAY.key}}</code></td>
                    <td><code>{{news.ARRAY.content.title}}</code></td>
                </tr>
            </tbody>
        </table>

        <p><small>Wildcard joins all non-empty values with comma separation.</small></p>

        <hr>

        <h2>7. File Attachments</h2>
        <p>Reference uploaded files in prompts with angle markers:</p>
        
        <pre><code>&lt;&lt;filename.pdf&gt;&gt;</code></pre>
        
        <p>Ensure the file is attached to the relevant document. The system will extract and embed the content automatically.</p>

        <hr>

        <h2>8. Variable Collision & Fallback</h2>
        <p>If a variable cannot be resolved:</p>
        <ul>
            <li>Returns empty string for field paths</li>
            <li>Returns <code>[Error: ...]</code> for periods formatting failures</li>
            <li>JSON decode errors yield blank output</li>
        </ul>

        <hr>

        <h2>9. Best Practices</h2>
        
        <div class="tip-box">
            <ul>
                <li>Start with a concise context header (Security + latest periods)</li>
                <li>Use structured periods instead of dumping raw JSON blobs</li>
                <li>Use pre-computed portfolio analytics instead of asking AI to calculate aggregations</li>
                <li>Avoid mixing large JSON (<code>{{periods:quarterly:8:json}}</code>) with verbose narrative requests</li>
                <li>Chain reasoning: supply data → ask specific analytical questions</li>
                <li>For portfolio analysis: inject all pre-computed metrics upfront for AI interpretation</li>
            </ul>
        </div>

        <h3>Security Analysis Template:</h3>
        <pre><code>Company Overview: {{security_name}} ({{symbol}})
Sector: {{sector}} Industry: {{industry}}

Latest Annual Performance:
{{periods:annual:3}}

Quarterly Trend:
{{periods:quarterly:4:table}}

Key News: {{news.ARRAY.content.title}}</code></pre>

        <h3>Portfolio Analysis Template:</h3>
        <pre><code>Portfolio: ((portfolio_name))
Risk Profile: ((risk_profile))
Base Currency: ((currency))
Current Value: ((current_value))
Total Returns: ((returns_total)) (((returns_percentage_total))%)

## Concentration Risk
Top 5 Holdings: ((top_5_concentration))%

## Sector Exposure
((sector_allocations))

## Geographic Distribution
((region_allocations))

## Currency Exposure
((currency_exposure))

## Target vs. Actual Allocations
((target_vs_actual_allocations))

## Holdings Performance
[Holdings data expands here via ***HOLDINGS*** blocks]</code></pre>

        <hr>

        <h2>10. Troubleshooting</h2>
        
        <table>
            <thead>
                <tr>
                    <th>Issue</th>
                    <th>Cause</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Empty periods block</td>
                    <td>No matching CF Financial Period records</td>
                    <td>Import financials first</td>
                </tr>
                <tr>
                    <td><code>[Error: ...]</code> in output</td>
                    <td>Formatting or fetch failure</td>
                    <td>Re-check variable syntax</td>
                </tr>
                <tr>
                    <td>Huge token usage</td>
                    <td>Too many periods / JSON format</td>
                    <td>Reduce count or switch to <code>markdown</code></td>
                </tr>
                <tr>
                    <td>Missing holding values</td>
                    <td>Holding context absent</td>
                    <td>Ensure prompt executed in portfolio holding loop</td>
                </tr>
            </tbody>
        </table>

        <hr>

        <h2>11. Diff from Legacy</h2>
        <p>Legacy relied on raw blob fields (<code>profit_loss</code>, <code>balance_sheet</code>, <code>cash_flow</code>). New system uses normalized CF Financial Period records + computed metrics (margins, ROE, growth). Prefer <code>{{periods:...}}</code> going forward.</p>

        <hr>

        <h2>12. SEC Edgar Qualitative Text</h2>
        <p>Extract narrative sections from SEC Edgar filings for qualitative AI analysis. These variables fetch textual content (Risk Factors, MD&A, Business Descriptions) rather than structured financial data.</p>

        <div class="warning-box">
            <strong>⚠️ CIK Required:</strong> Security must have a CIK (Central Index Key) set. Use <strong>Actions → Fetch CIK</strong> in CF Security to obtain it automatically for US-listed companies.
        </div>

        <h3>Syntax:</h3>
        <pre><code>{{edgar:form_type:year_or_index[:section][:quarter]}}</code></pre>

        <h3>Parameters:</h3>
        <table>
            <thead>
                <tr>
                    <th>Parameter</th>
                    <th>Description</th>
                    <th>Examples</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>form_type</code></td>
                    <td>SEC filing form type</td>
                    <td><code>10-K</code>, <code>10-Q</code>, <code>8-K</code></td>
                </tr>
                <tr>
                    <td><code>year_or_index</code></td>
                    <td>Negative for relative (-1=latest, -2=previous)<br>Positive 4-digit for absolute year</td>
                    <td><code>-1</code>, <code>-2</code>, <code>2024</code>, <code>2023</code></td>
                </tr>
                <tr>
                    <td><code>section</code><br>(optional)</td>
                    <td>Section keyword to extract<br>Omit for default selection</td>
                    <td><code>risk</code>, <code>mda</code>, <code>business</code>, <code>legal</code>, <code>all</code></td>
                </tr>
                <tr>
                    <td><code>quarter</code><br>(10-Q only)</td>
                    <td>Quarter specification for 10-Q filings</td>
                    <td><code>Q1</code>, <code>Q2</code>, <code>Q3</code></td>
                </tr>
            </tbody>
        </table>

        <h3>Section Keywords:</h3>
        <table>
            <thead>
                <tr>
                    <th>Keyword</th>
                    <th>Description</th>
                    <th>Typical Tokens</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>risk</code></td>
                    <td>Item 1A: Risk Factors - forward-looking risks and uncertainties</td>
                    <td>10K-30K</td>
                </tr>
                <tr>
                    <td><code>mda</code></td>
                    <td>Item 7: Management Discussion & Analysis - management's perspective on performance</td>
                    <td>15K-40K</td>
                </tr>
                <tr>
                    <td><code>business</code></td>
                    <td>Item 1: Business Description - company operations, products, markets</td>
                    <td>5K-15K</td>
                </tr>
                <tr>
                    <td><code>legal</code></td>
                    <td>Item 3: Legal Proceedings - significant litigation and legal matters</td>
                    <td>2K-10K</td>
                </tr>
                <tr>
                    <td><code>all</code></td>
                    <td>Complete filing text - entire document</td>
                    <td>100K-200K</td>
                </tr>
                <tr>
                    <td><em>(omit)</em></td>
                    <td><strong>Default:</strong> Combines risk + mda + business for comprehensive overview</td>
                    <td>30K-80K</td>
                </tr>
            </tbody>
        </table>

        <h3>Examples:</h3>

        <h4>10-K Annual Reports:</h4>
        <div class="example-box">
            <ul>
                <li><code>{{edgar:10-K:-1}}</code> → Latest 10-K with default sections (risk + mda + business)</li>
                <li><code>{{edgar:10-K:-1:risk}}</code> → Latest 10-K risk factors only</li>
                <li><code>{{edgar:10-K:-2:mda}}</code> → Previous year's MD&A section</li>
                <li><code>{{edgar:10-K:2023}}</code> → 2023 10-K with default sections</li>
                <li><code>{{edgar:10-K:2023:all}}</code> → Complete 2023 10-K text (⚠️ very large)</li>
            </ul>
        </div>

        <h4>10-Q Quarterly Reports:</h4>
        <div class="example-box">
            <ul>
                <li><code>{{edgar:10-Q:-1}}</code> → Latest 10-Q with default sections</li>
                <li><code>{{edgar:10-Q:-1:mda}}</code> → Latest quarterly MD&A</li>
                <li><code>{{edgar:10-Q:2024:Q2}}</code> → Q2 2024 10-Q with default sections</li>
                <li><code>{{edgar:10-Q:2024:Q2:risk}}</code> → Q2 2024 risk factors (if updated)</li>
            </ul>
        </div>

        <h4>8-K Current Reports (Material Events):</h4>
        <div class="example-box">
            <ul>
                <li><code>{{edgar:8-K:-1}}</code> → Latest 3 8-K filings aggregated</li>
                <li><code>{{edgar:8-K:2024}}</code> → <strong>All 8-K filings from 2024 aggregated</strong></li>
                <li><code>{{edgar:8-K:2023}}</code> → All 8-K filings from 2023</li>
            </ul>
        </div>

        <div class="tip-box">
            <strong>8-K Special Behavior:</strong>
            <ul>
                <li><strong>Relative index</strong> (-1, -2, etc.): Aggregates latest N filings (default 3)</li>
                <li><strong>Absolute year</strong> (2024, 2023, etc.): Aggregates ALL 8-K filings from that entire year</li>
                <li>Each 8-K includes metadata (filing date, accession number) and all reported items</li>
                <li>Useful for tracking significant events like acquisitions, executive changes, material agreements</li>
            </ul>
        </div>

        <h3>Metadata Headers:</h3>
        <p>Each extracted filing includes a metadata header for context:</p>
        <pre><code>**10-K Filing**
Filed: 2024-02-01
Period: 2023-12-31
Accession: 0000320193-24-000010

[Section content follows...]</code></pre>
        <p><small>Metadata adds approximately 15-25 tokens per filing but provides essential context for AI analysis.</small></p>

        <h3>Token Budget Planning:</h3>
        <div class="warning-box">
            <strong>⚠️ Token Size Warnings:</strong>
            <table style="width: 100%; margin-top: 10px;">
                <thead>
                    <tr>
                        <th>Content Type</th>
                        <th>Estimated Tokens</th>
                        <th>Recommendation</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Single section (risk/mda/business)</td>
                        <td>5K-40K</td>
                        <td>✅ Safe for most prompts</td>
                    </tr>
                    <tr>
                        <td>Default 10-K (risk+mda+business)</td>
                        <td>30K-80K</td>
                        <td>⚠️ Use for focused analysis</td>
                    </tr>
                    <tr>
                        <td>Full document (all)</td>
                        <td>100K-200K</td>
                        <td>❌ Avoid unless necessary</td>
                    </tr>
                    <tr>
                        <td>Year of 8-Ks (e.g., 2024)</td>
                        <td>10K-100K</td>
                        <td>⚠️ Varies by company activity</td>
                    </tr>
                    <tr>
                        <td>Latest 3 8-Ks</td>
                        <td>3K-15K</td>
                        <td>✅ Good for recent events</td>
                    </tr>
                </tbody>
            </table>
            <p style="margin-top: 10px;"><strong>Automatic Truncation:</strong> Content is automatically truncated at 100,000 characters (~25K tokens) with a notice. Original length is logged for reference.</p>
        </div>

        <h3>Best Practices:</h3>
        <div class="tip-box">
            <ul>
                <li><strong>Start specific:</strong> Use single sections (risk, mda) rather than defaults for token efficiency</li>
                <li><strong>Combine with financials:</strong> Use <code>{{financials:y3:q4}}</code> for quantitative data alongside <code>{{edgar:10-K:-1:risk}}</code> for qualitative insights</li>
                <li><strong>Year-over-year analysis:</strong> Compare <code>{{edgar:10-K:-1:risk}}</code> vs <code>{{edgar:10-K:-2:risk}}</code> to track risk evolution</li>
                <li><strong>Recent events:</strong> Use <code>{{edgar:8-K:-1}}</code> for latest material developments</li>
                <li><strong>Annual retrospective:</strong> Use <code>{{edgar:8-K:2024}}</code> to review all significant events from a year</li>
                <li><strong>Check CIK first:</strong> Verify security has CIK before using edgar variables in prompts</li>
            </ul>
        </div>

        <h3>Error Handling:</h3>
        <p>Variables gracefully handle errors and return informative placeholders:</p>
        <ul>
            <li><code>[CIK required for edgar variable - fetch CIK using Actions → Fetch CIK]</code> - Security missing CIK</li>
            <li><code>[No 10-K filing found for year 2024]</code> - Requested filing not available</li>
            <li><code>[Insufficient filings: requested index 5 but only 3 available]</code> - Relative index out of range</li>
            <li><code>[No 10-Q filing found for 2024 Q2]</code> - Specific quarter not found</li>
            <li><code>[risk_factors section not available in this filing]</code> - Section doesn't exist (common for 10-Q risk factors)</li>
        </ul>

        <hr>

        <h2>13. Quick Reference Cheat Sheet</h2>
        
        <table>
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Syntax</th>
                    <th>Example</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Security Field</td>
                    <td><code>{{field}}</code></td>
                    <td><code>{{current_price}}</code></td>
                </tr>
                <tr>
                    <td>Holding Field</td>
                    <td><code>[[field]]</code></td>
                    <td><code>[[quantity]]</code></td>
                </tr>
                <tr>
                    <td>Portfolio Field</td>
                    <td><code>((field))</code></td>
                    <td><code>((current_value))</code></td>
                </tr>
                <tr>
                    <td>Pre-Computed Analytics</td>
                    <td><code>((analytics_field))</code></td>
                    <td><code>((top_5_concentration))</code></td>
                </tr>
                <tr>
                    <td>Sector Allocations</td>
                    <td><code>((sector_allocations))</code></td>
                    <td>Formatted markdown list</td>
                </tr>
                <tr>
                    <td>Region Allocations</td>
                    <td><code>((region_allocations))</code></td>
                    <td>Formatted markdown list</td>
                </tr>
                <tr>
                    <td>Country Allocations</td>
                    <td><code>((country_allocations))</code></td>
                    <td>Formatted markdown list</td>
                </tr>
                <tr>
                    <td>Currency Exposure</td>
                    <td><code>((currency_exposure))</code></td>
                    <td>Formatted markdown list</td>
                </tr>
                <tr>
                    <td>Target vs Actual</td>
                    <td><code>((target_vs_actual_allocations))</code></td>
                    <td>Formatted comparison blocks</td>
                </tr>
                <tr>
                    <td>Financial Periods</td>
                    <td><code>{{periods:type:count[:format]}}</code></td>
                    <td><code>{{periods:annual:3}}</code></td>
                </tr>
                <tr>
                    <td>Period Comparison</td>
                    <td><code>{{periods:compare:A:B}}</code></td>
                    <td><code>{{periods:compare:2024:2023}}</code></td>
                </tr>
                <tr>
                    <td>Relative Comparison</td>
                    <td><code>{{periods:compare:latest_annual:previous_annual}}</code></td>
                    <td><code>{{periods:compare:latest_quarterly:yoy_quarterly}}</code></td>
                </tr>
                <tr>
                    <td>JSON Index</td>
                    <td><code>{{jsonfield.0.key}}</code></td>
                    <td><code>{{news.0.content.title}}</code></td>
                </tr>
                <tr>
                    <td>JSON Wildcard</td>
                    <td><code>{{jsonfield.ARRAY.key}}</code></td>
                    <td><code>{{news.ARRAY.content.title}}</code></td>
                </tr>
                <tr>
                    <td>Attachment</td>
                    <td><code>&lt;&lt;file.pdf&gt;&gt;</code></td>
                    <td><code>&lt;&lt;q3_report.pdf&gt;&gt;</code></td>
                </tr>
                <tr>
                    <td><strong>Edgar 10-K</strong></td>
                    <td><code>{{edgar:10-K:year[:section]}}</code></td>
                    <td><code>{{edgar:10-K:-1:risk}}</code> - Latest 10-K risk factors</td>
                </tr>
                <tr>
                    <td><strong>Edgar 10-Q</strong></td>
                    <td><code>{{edgar:10-Q:year[:section][:quarter]}}</code></td>
                    <td><code>{{edgar:10-Q:2024:Q2:mda}}</code> - Q2 2024 MD&A</td>
                </tr>
                <tr>
                    <td><strong>Edgar 8-K</strong></td>
                    <td><code>{{edgar:8-K:year}}</code></td>
                    <td><code>{{edgar:8-K:2024}}</code> - All 2024 8-K filings</td>
                </tr>
            </tbody>
        </table>

        <div class="footer">
            <p>For updates watch release notes. Suggestions welcome.</p>
        </div>
    </div>
</body>
</html>
{% endraw %}